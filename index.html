<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>EGR Staff Hub – Login</title>
<link rel="stylesheet" href="/css/login.css">
</head>
<body>
<section class="login">
  <h1>Emirates Group Roblox Staff Hub</h1>
  <p>DM the EGR Bot with <b>/login</b> to get a 6-digit code (valid 5 min).</p>

  <input id="otp" type="text" maxlength="6" placeholder="Enter 6-digit code">
  <button id="loginBtn">Sign In</button>
  <p id="msg"></p>
</section>

<script>
const API="https://script.google.com/macros/s/AKfycbwcYich_WKLDcHzomsvULMPwXN6ocSAmIX3-2Z5mVE8HZsI_-0gJRWzjHQLZLsCp1bM/exec";
const $=s=>document.querySelector(s);
$("#loginBtn").onclick=()=>{
  const otp=$("#otp").value.trim();
  if(otp.length!==6){$("#msg").textContent="Enter valid code";return;}
  const cb="cb_"+Math.random().toString(36).slice(2);
  window[cb]=r=>{
    if(r.ok){
      localStorage.setItem("egr_token",r.token);
      localStorage.setItem("egr_profile",JSON.stringify(r.profile));
      $("#msg").textContent="✅ Welcome "+(r.profile.discord_username||"");
      setTimeout(()=>location="dashboard.html",1200);
    }else{$("#msg").textContent="❌ "+r.error;}
    delete window[cb];
  };
  const q=new URLSearchParams({method:"redeemOtp",callback:cb,otp});
  const s=document.createElement("script");s.src=API+"?"+q;document.body.appendChild(s);
};
</script>
</body>
</html>